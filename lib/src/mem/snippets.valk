
use mem

snippet func_entry() {
    mem:mem_depth++
}
snippet func_exit() {
    mem:mem_depth--
}

snippet gc_check_func() {
    {
        if mem_usage > 10 {
            if mem_usage > 10 + mem_depth {
                gc()
            }
        }
    }
}
snippet gc_check_loop() {
    // {
    //     let usage = mem_new / (mem_trigger / 100)
    //     if usage > 10 {
    //         mem_usage = usage
    //         update_usage()
    //     }
    // }
}